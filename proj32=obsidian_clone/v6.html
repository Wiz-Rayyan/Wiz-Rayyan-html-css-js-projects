<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Viewer with JS Execution</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            width: 100%;
            max-width: 1400px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            margin: 20px 0;
        }
        
        header {
            background: #4a4e69;
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .panels {
            display: flex;
            flex-direction: column;
            height: 600px;
        }
        
        .editor-panel, .js-panel {
            display: flex;
            height: 50%;
            border-top: 1px solid #eee;
        }
        
        .editor, .preview, .js-editor, .js-preview {
            flex: 1;
            padding: 15px;
            overflow: auto;
        }
        
        .editor, .js-editor {
            background: #f9f9f9;
            border-right: 1px solid #eee;
        }
        
        textarea {
            width: 100%;
            height: 100%;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 14px;
            line-height: 1.5;
            resize: none;
        }
        
        .preview, .js-preview {
            background: white;
        }
        
        .panel-label {
            background: #5a5e79;
            color: white;
            padding: 8px 15px;
            font-weight: bold;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            padding: 15px 20px;
            background: #f5f5f5;
            border-top: 1px solid #eee;
        }
        
        button {
            background: #4a4e69;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
            margin: 0 5px;
        }
        
        button:hover {
            background: #5a5e79;
        }
        
        .info-box {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            max-width: 1400px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .info-box h2 {
            color: #4a4e69;
            margin-bottom: 15px;
            border-bottom: 2px solid #4a4e69;
            padding-bottom: 10px;
        }
        
        .philosopher-card {
            background: linear-gradient(to right, #667eea, #764ba2);
            padding: 20px;
            border-radius: 10px;
            margin: 25px 0;
            color: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        #console-output {
            height: 100%;
            overflow: auto;
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Markdown Viewer with JS Execution</h1>
            <p>A tool that renders Markdown, HTML, CSS, and executes JavaScript</p>
        </header>
        
        <div class="panels">
            <div class="editor-panel">
                <div class="editor">
                    <div class="panel-label">Markdown/HTML Editor</div>
                    <textarea id="editor"><div class="philosopher-card">
  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/43/Immanuel_Kant_%28painted_portrait%29.jpg/200px-Immanuel_Kant_%28painted_portrait%29.jpg" alt="Immanuel Kant" style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; display: block; margin: 0 auto; border: 3px solid white;">
  <h2 style="text-align: center; margin: 15px 0; color: white; font-family: 'Georgia', serif;">Immanuel Kant</h2>
  <h3 style="text-align: center; margin: 10px 0; color: #ffd700; font-style: italic;">Categorical Imperative</h3>
  
  <label for="kant-toggle" style="display: inline-block; padding: 8px 15px; background: #ffd700; color: #333; border-radius: 4px; cursor: pointer; margin: 10px 0; font-weight: bold;">Toggle Details</label>
  <input id="kant-toggle" type="checkbox" style="display: none;">
  
  <div>
    <blockquote style="font-style: italic; text-align: center; border-left: 3px solid #ffd700; padding: 10px; margin: 15px 0; background: rgba(255, 215, 0, 0.1);">"Act only according to that maxim whereby you can at the same time will that it should become a universal law."</blockquote>
    <img src="https://i.pinimg.com/736x/3a/3b/6a/3a3b6a6a6a6a6a6a6a6a6a6a6a6a6a6a.jpg" alt="Categorical Imperative" style="width: 100%; border-radius: 8px; margin: 15px 0;">
    <p style="text-align: justify; line-height: 1.6;">Kant revolutionized ethics with his concept of the categorical imperative - a universal moral law that applies to all rational beings. He argued that moral actions must be guided by principles that could apply universally, and that we should treat humanity always as an end in itself, never merely as a means.</p>
  </div>
</div></textarea>
                </div>
                <div class="preview">
                    <div class="panel-label">HTML Preview</div>
                    <div id="preview"></div>
                </div>
            </div>
            
            <div class="js-panel">
                <div class="js-editor">
                    <div class="panel-label">JavaScript Editor</div>
                    <textarea id="js-editor">// This function will be called after the HTML is rendered
function initKantToggle() {
    console.log("Initializing Kant toggle...");
    
    const toggle = document.getElementById('kant-toggle');
    const details = document.querySelector('.philosopher-card div:last-child');
    const label = document.querySelector('label[for="kant-toggle"]');
    
    if (toggle && details && label) {
        console.log("All elements found");
        
        // Initialize the details state
        details.style.maxHeight = '0';
        details.style.overflow = 'hidden';
        details.style.transition = 'max-height 0.5s ease';
        
        // Add click event to the label
        label.addEventListener('click', function() {
            console.log("Toggle clicked");
            toggle.checked = !toggle.checked;
            
            if (toggle.checked) {
                details.style.maxHeight = details.scrollHeight + 'px';
                console.log("Details shown");
            } else {
                details.style.maxHeight = '0';
                console.log("Details hidden");
            }
        });
        
        console.log("Kant toggle initialized successfully");
    } else {
        console.error("Could not find all required elements");
        console.log("Toggle:", toggle);
        console.log("Details:", details);
        console.log("Label:", label);
    }
}

// Call the initialization function
initKantToggle();</textarea>
                </div>
                <div class="js-preview">
                    <div class="panel-label">JavaScript Console</div>
                    <div id="console-output"></div>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <div>
                <button id="render-btn">Render Content</button>
                <button id="execute-js-btn">Execute JavaScript</button>
            </div>
            <div>
                <button id="clear-btn">Clear All</button>
            </div>
        </div>
    </div>
    
    <div class="info-box">
        <h2>Why JavaScript Execution Wasn't Working</h2>
        <div style="line-height: 1.6;">
            <p><strong>The main issues were:</strong></p>
            <ol>
                <li><strong>Context Isolation</strong>: The JavaScript was trying to manipulate DOM elements that were in a different context</li>
                <li><strong>Execution Timing</strong>: JavaScript was executing before the DOM elements were fully rendered</li>
                <li><strong>Scope Problems</strong>: Functions defined in the JavaScript editor didn't have access to the rendered HTML elements</li>
            </ol>
            
            <p><strong>How this solution fixes those issues:</strong></p>
            <ol>
                <li>We ensure the HTML is fully rendered before executing JavaScript</li>
                <li>We execute the JavaScript in the same context as the rendered HTML</li>
                <li>We added detailed console logging to debug any issues</li>
            </ol>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const editor = document.getElementById('editor');
            const jsEditor = document.getElementById('js-editor');
            const preview = document.getElementById('preview');
            const consoleOutput = document.getElementById('console-output');
            const renderBtn = document.getElementById('render-btn');
            const executeJsBtn = document.getElementById('execute-js-btn');
            const clearBtn = document.getElementById('clear-btn');
            
            // Configure marked to not sanitize HTML
            marked.setOptions({
                breaks: true,
                gfm: true,
                sanitize: false  // This allows HTML tags to pass through
            });
            
            // Store the original console functions
            const originalConsole = {
                log: console.log,
                error: console.error,
                warn: console.warn,
                info: console.info
            };
            
            // Function to capture console output
            function captureConsole() {
                console.log = function() {
                    originalConsole.log.apply(console, arguments);
                    const message = Array.from(arguments).join(' ');
                    consoleOutput.innerHTML += `<div style="color: #f8f8f2;">${message}</div>`;
                    consoleOutput.scrollTop = consoleOutput.scrollHeight;
                };
                
                console.error = function() {
                    originalConsole.error.apply(console, arguments);
                    const message = Array.from(arguments).join(' ');
                    consoleOutput.innerHTML += `<div style="color: #ff6b6b;">${message}</div>`;
                    consoleOutput.scrollTop = consoleOutput.scrollHeight;
                };
                
                console.warn = function() {
                    originalConsole.warn.apply(console, arguments);
                    const message = Array.from(arguments).join(' ');
                    consoleOutput.innerHTML += `<div style="color: #ffd93d;">${message}</div>`;
                    consoleOutput.scrollTop = consoleOutput.scrollHeight;
                };
                
                console.info = function() {
                    originalConsole.info.apply(console, arguments);
                    const message = Array.from(arguments).join(' ');
                    consoleOutput.innerHTML += `<div style="color: #6bcaff;">${message}</div>`;
                    consoleOutput.scrollTop = consoleOutput.scrollHeight;
                };
            }
            
            // Restore original console
            function restoreConsole() {
                console.log = originalConsole.log;
                console.error = originalConsole.error;
                console.warn = originalConsole.warn;
                console.info = originalConsole.info;
            }
            
            // Function to render Markdown/HTML
            function renderContent() {
                const markdownText = editor.value;
                const htmlContent = marked.parse(markdownText);
                
                // Render the HTML content
                preview.innerHTML = htmlContent;
                
                // Clear console
                consoleOutput.innerHTML = '';
                
                // Capture console output
                captureConsole();
                
                console.log('Content rendered successfully');
            }
            
            // Function to execute JavaScript
            function executeJavaScript() {
                const jsCode = jsEditor.value;
                
                try {
                    // Execute the JavaScript code
                    const execute = new Function(jsCode);
                    execute();
                    console.log('JavaScript executed successfully');
                } catch (error) {
                    console.error('Error executing JavaScript:', error.message);
                }
            }
            
            // Combined render and execute function
            function renderAndExecute() {
                renderContent();
                // Small delay to ensure DOM is fully rendered
                setTimeout(executeJavaScript, 50);
            }
            
            // Initial render
            renderContent();
            
            // Event listeners
            renderBtn.addEventListener('click', renderContent);
            
            executeJsBtn.addEventListener('click', function() {
                // If content hasn't been rendered yet, render it first
                if (preview.innerHTML.trim() === '') {
                    renderAndExecute();
                } else {
                    executeJavaScript();
                }
            });
            
            // Combined render and execute button
            const renderExecuteBtn = document.createElement('button');
            renderExecuteBtn.textContent = 'Render & Execute';
            renderExecuteBtn.addEventListener('click', renderAndExecute);
            document.querySelector('.controls > div').appendChild(renderExecuteBtn);
            
            clearBtn.addEventListener('click', function() {
                editor.value = '';
                jsEditor.value = '';
                preview.innerHTML = '';
                consoleOutput.innerHTML = '';
                console.log('Cleared all content');
            });
            
            // Auto-render when content changes (with debouncing)
            let renderTimeout;
            editor.addEventListener('input', function() {
                clearTimeout(renderTimeout);
                renderTimeout = setTimeout(renderContent, 500);
            });
        });
    </script>
</body>
</html>