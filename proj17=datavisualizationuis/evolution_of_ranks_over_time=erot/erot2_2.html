<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Rank Evolution Chart - Animated with Input</title>
  <style>
    body {
      font-family: sans-serif;
      background: #1e1e2f;
      color: white;
      padding: 20px;
    }
    .input-area {
      margin-bottom: 20px;
    }
    textarea {
      width: 100%;
      height: 100px;
      font-family: monospace;
      margin-bottom: 10px;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 5px;
    }
    .chart {
      position: relative;
      width: 1000px;
      height: 400px;
      border-left: 2px solid #aaa;
      border-bottom: 2px solid #aaa;
      margin-top: 40px;
    }
    .object-label {
      position: absolute;
      left: -40px;
      transform: translateY(-50%);
      width: 30px;
      text-align: right;
    }
    svg {
      position: absolute;
      top: 0;
      left: 0;
      overflow: visible;
    }
    .line {
      fill: none;
      stroke-width: 3;
      transition: all 1s ease;
    }
  </style>
</head>
<body>
  <h2>Animated Rank Evolution Chart</h2>

  <div class="input-area">
    <label>Enter years (comma-separated):</label>
    <textarea id="yearsInput">2016,2017,2018</textarea>

    <label>Enter rank data per year (e.g. 2016:A,B,C,D,E,F):</label>
    <textarea id="rankInput">2016:A,B,C,D,E,F
2017:A,B,C,E,F,D
2018:B,A,E,D,F,C</textarea>


    <button onclick="renderChart()">Render Chart</button>
  </div>

  <div class="chart" id="chart">
    <svg width="1000" height="400"></svg>
  </div>

  <script>
    const chart = document.getElementById("chart");
    const svg = chart.querySelector("svg");

    const chartHeight = chart.clientHeight;
    const chartWidth = chart.clientWidth;
    const rowHeight = chartHeight / 6; // Will be dynamically calculated

    const colors = ['#ff4b5c', '#ffb400', '#2ecc71', '#3498db', '#9b59b6', '#1abc9c'];

    function renderChart() {
      svg.innerHTML = '';
      [...document.querySelectorAll(".object-label")].forEach(e => e.remove());

      const years = document.getElementById("yearsInput").value.split(',').map(s => s.trim());
      const rankLines = document.getElementById("rankInput").value.trim().split('\n');
      const ranks = {};
      rankLines.forEach(line => {
        const [year, list] = line.split(':');
        ranks[year.trim()] = list.split(',').map(s => s.trim());
      });

      const objects = Array.from(new Set(Object.values(ranks).flat()));
      const objectCount = objects.length;
      const spacingY = chartHeight / objectCount;
      const spacingX = chartWidth / (years.length - 1);

      // Add vertical object labels
      objects.forEach((obj, index) => {
        const label = document.createElement("div");
        label.className = "object-label";
        label.style.top = `${(index + 0.5) * spacingY}px`;
        label.textContent = obj;
        chart.appendChild(label);
      });

      objects.forEach((obj, objIdx) => {
        const points = [];
        years.forEach((year, i) => {
          const yList = ranks[year];
          const y = (yList.indexOf(obj) + 0.5) * spacingY;
          const x = i * spacingX;
          points.push([x, y]);
        });

        const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
        let d = `M ${points[0][0]},${points[0][1]}`;
        for (let i = 1; i < points.length; i++) {
          const [x1, y1] = points[i - 1];
          const [x2, y2] = points[i];
          const cx = (x1 + x2) / 2;
          d += ` C ${cx},${y1} ${cx},${y2} ${x2},${y2}`;
        }
        path.setAttribute("d", d);
        path.setAttribute("class", "line");
        path.setAttribute("stroke", colors[objIdx % colors.length]);
        path.setAttribute("stroke-dasharray", "2000");
        path.setAttribute("stroke-dashoffset", "2000");
        svg.appendChild(path);

        // Animate path
        setTimeout(() => {
          path.style.transition = 'stroke-dashoffset 2s ease-out';
          path.setAttribute("stroke-dashoffset", "0");
        }, 100);
      });
    }

    // Initial render
    renderChart();
  </script>
</body>
</html>
